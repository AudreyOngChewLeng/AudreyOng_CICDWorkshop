name: CICD workshop
on:
    push:
      branches:
          - 'v[0-9]+.[0-9]+'

jobs:
    CICD_workshop:
        runs-on: ubuntu-latest

        steps:
            - name: checkout test
              id: checkout_test
              uses: actions/checkout@v4

            # - name: run trivy scanner
            #   id: run_trivy_scanner
            #   uses: aquasecurity/trivy-action@master
            #   with:
            #     scan-type: 'fs'
            #     ignore-unfixed: true
            #     format: 'table'
            #     output: 'trivy-report.txt'
            #     severity: 'HIGH'
            #     exit-code: '1'

            - name: trial run
              id: trial_run
              run: echo "hello" > hello.txt

            - name: list directory
              id: list_directory
              if: always()
              run: echo "$(ls -l)"

            - run: 'echo ${{ github.event.inputs.message }} > message.txt'

            - name: send trivy report
              id: send_trivy_report
              if: always()
              uses: MeilCli/slack-upload-file@v3.0.0
              with:
                slack_token: ${{ secrets.SLACK_TOKEN }}
                slack_api_url: ${{ secrets.SLACK_WEBHOOK }}
                content: 'file content'
                file_name: 'hello.txt'
                title: 'hello'
                initial_comment: 'hello'

            - run: 'echo ${{ fromJson(steps.message.outputs.response).files[0].file.permalink }}'

            # - name: send to slack
            #   id: send_to_slack
            #   if: success()
            #   uses: rtCamp/action-slack-notify@v2
            #   env:
            #     SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK }}
            #   with:
            #     SLACK_CHANNEL: general
            #     SLACK_COLOR: ${{ job.status }}
            #     SLACK_USERNAME: TestingName
            #     SLACK_TITLE: Test
            #     SLACK_MESSAGE: "Test"